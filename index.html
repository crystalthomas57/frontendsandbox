<!DOCTYPE html>
<html lang="en">

  <head>
    <!--meta bs-->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- unnessesary title tag-->
    <title>Login Page</title>
    <!--script tags are used to refference javascript code.
    this tag loads the jQuery library from 
    Google’s public Content Delivery Network (CDN)-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"> </script>
     <!-- import the style.css file -->
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <!-- This div is an input of a navigation bar or header bar at the top-->
    <!-- <div class = "header">
      <div class=" header-right">
        <a href="#home">Home</a>
        <a href="database" >Database</a>
        <a href=" about">About</a>
      </div>  -->

    </div>
    <center>
        <!-- wraps information in a container -->
      <div class="container">
        <h1><center>Create Account</center></h1>
        <img
          src="loginimage.jpeg"
          alt="Login Person"
        />

<!-- <input type="text" id="inputValue" placeholder="Enter student ID">
<button id='sendButton'>Search</button>
<pre id="result"></pre> -->

<!-- HTML Added to make CreateUser button added by CJT work-->

 <!-- <div id="section_createuser">
    <input type="text" id="username" placeholder="Username">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <input type="text" id="occupation" placeholder="Occupation">

    <button id="btncreateuser">Create User</button>
  </div> -->
  <div class="container" id="section_createuser">
      <div class="center" id="createuser">
          <form action="" method="POST" id="createuser">
              <div class="txt_field" id="createuser">
                  <input type="text" id ="username" name="text" placeholder="UserName">
                  <span></span>
                  <input type="email" id="email" placeholder="Email">
                  <span></span>
                  <input type="password" id="password" placeholder="Password">
                  <span></span>
                  <input type="text" id="occupation" placeholder="Occupation">
                  <span></span>
                  <button id="btncreateuser" type="button"> Create NewUser</button>
                  <span></span>
              </div>

<h2>Response:</h2>
<pre id="responseDisplay"></pre>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var btn_createuser = document.getElementById("btncreateuser");

   btn_createuser.addEventListener('click', function(event) {
  event.preventDefault(); // Stop form from reloading
  createUser();
    });
  });

  function createUser() {
    const section = document.getElementById('section_createuser');

    const userData = {
        user_id: generateUserId(), // if your backend expects a user_id
        username: section.querySelector('#username').value.trim(),
        email: section.querySelector('#email').value.trim(),
        password: section.querySelector('#password').value,
        occupation: section.querySelector('#occupation').value.trim()
    };

    // Simple validation
    if (!userData.username || !userData.email || !userData.password || !userData.occupation) {
      alert('Please fill all fields!');
      return;
    }
  
    fetch('http://127.0.0.1:5000/create_user', {  // Match your Flask endpoint URL here
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
        },
        body: JSON.stringify(userData)
    })
    .then(response => response.json())
    .then(data => {
        console.log('Server response:', data);
        document.getElementById('responseDisplay').textContent = JSON.stringify(data, null, 2);
        if(data.message) {
          alert('User created successfully!');
        } else if(data.error) {
          alert('Error: ' + data.error);
        }
    })
    .catch(error => {
      console.error('Error creating user:', error);
        alert('Failed to create user.');
    });
  }

  // Optional: Simple function to generate a random user ID (if needed)
  function generateUserId() {
    return 'user_' + Math.floor(Math.random() * 1000000);
  }
</script>


<!-- <script>
  /* CJT cleaned up jquery method listening to click event of the buton named sendbutton*/
    $(document).ready(function() {
        $('#sendButton').click(function() {
            const inputValue = $('#inputValue').val();
            //fetchStudent(inputValue); //CJT added to test 8-4-2025
            getStudent(inputValue);
        });
      /* Adding here to take advantage of the Document Ready function wrapper already in place.
          another clicked event this time as a javascript listener to a DOM Element Button vs above jquery on click function*/
          //Crystal add the html to make this function work
        var btn_createuser = document.getElementById("btncreateuser");
          
          bbtn_createuser.addEventListener('click', function() {
          createUser();     
        });
    });

      /* CJT added Create user javascript function it will get all the fields in the div with id of section_createuser
      and post the data to a python creatuser endpoint acception posts. 
      
      Crystal Read this function and build the HTML Next Create a python Endpoint that accepts a post
      and inserts this data into the database */

  function createUser() {
    // Collect data from inputs inside #section_createuser
    const section = document.getElementById('section_createuser');
    const userData = {
        username: section.querySelector('#username').value,
        email: section.querySelector('#email').value,
        password: section.querySelector('#password').value,
        occupation: section.querySelector('#occupation').value,
    };

    // Send POST request to your Python service endpoint
    fetch('http://127.0.0.1:5000/CreateUser', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(userData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        console.log('User created successfully:', data);
        alert('User created successfully!');
    })
    .catch(error => {
        console.error('Error creating user:', error);
        alert('Failed to create user.');
    });
}
  function fetchStudent(i) {
    //const studentId = document.getElementById("student_id").value;
    const url = "http://127.0.0.1:5000/get_student_by_id?student_id=" + i;

    try {
          const response = fetch(url, {
              method: 'GET',
              mode: 'cors',             // ✅ Enables CORS request
              headers: {
                  'Accept': 'application/json'
              }
          });
        if (!response.ok) {
            throw new Error("Network response was not ok");
        }
        const data = response.json();
       // document.getElementById("responseBox").textContent = JSON.stringify(data, null, 2);
    } catch (error) {
        console.error("Error fetching data:", error);
      }
  }
  function getStudent(i) {
   /*/ const formData = new FormData();
    formData.append('student_id', mystudent); */
   
    fetch('http://127.0.0.1:5000/get_student_by_id?student_id=' + i, {
        method: 'GET'
    })
    .then(response => {
        if (!response.ok) {
            throw new Error("Network response was not ok");
        }
        return response.json();
    })
    .then(data => {
        document.getElementById('result').textContent = JSON.stringify(data, null, 2);
    })
    .catch(error => {
        console.error('Error:', error);
        document.getElementById('result').textContent = 'Error retrieving student data.';
    });
}


    function sendData() {
        const studentId = document.getElementById('student_id').value;
        formData.append("student_id", studentId);
        fetch('/query', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ student_id: student_id })
        })
        .then(response => {
            if (!response.ok) throw new Error('Request failed');
            return "my script failed";
        })
        .then(data => {
          if (data.student) {
        const student = data.student;
        let output = "";
        for (const key in student) {
            output += `${key}: ${student[key]}\n`;
        }
            document.getElementById('responseBox').textContent = output;
        } else {
          document.getElementById('responseBox').textContent = data.message || 'No data found';
        }
      }).catch(error => {
            console.error('Error:', error);
            document.getElementById('responseBox').textContent = 'Request failed';
        });
    }

  async function fetchStudentById(studentId) {
  try {
    const response = await fetch('http://localhost:5000/query', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: (student_id )

    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error || 'Unknown error occurred');
    }

    const data = await response.json();
    console.log('Student Data:', data);
    const myElement = document.getElementById(student_div)
    myElement.innerHTML = data

    // Optionally, display data on the page
    if (data.student) {
      document.getElementById('result').textContent = JSON.stringify(data.student, null, 2);
    } else {
      document.getElementById('result').textContent = data.message;
    }

  } catch (error) {
    console.error('Fetch error:', error);
    document.getElementById('result').textContent = 'Error: ' + error.message;
  }
}
</script> -->
    </center>
  </label>
  </body>
</html>
